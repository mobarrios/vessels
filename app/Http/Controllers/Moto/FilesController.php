<?php

namespace App\Http\Controllers\Moto;

use App\Entities\Moto\Sales;
use App\Http\Controllers\Controller;
use App\Http\Repositories\Configs\VouchersRepo;
use App\Http\Repositories\Moto\BrandsRepo;
use App\Http\Repositories\Moto\CategoriesRepo;
use App\Http\Repositories\Moto\FilesRepo as Repo;
use App\Http\Repositories\Moto\Form12Repo;
use App\Http\Repositories\Moto\Form59Repo;
use App\Http\Repositories\Moto\ProvidersRepo;
use App\Http\Repositories\Moto\SalesRepo;
use Barryvdh\DomPDF\PDF;
use Illuminate\Http\Request;
use Illuminate\Routing\Route;


class FilesController extends Controller
{
    public function  __construct(Request $request, Repo $repo, Route $route,VouchersRepo $vouchersRepo, SalesRepo $salesRepo, Form12Repo $form12Repo, Form59Repo $form59Repo)
    {

        $this->request  = $request;
        $this->repo     = $repo;
        $this->route    = $route;
        $this->form12Repo    = $form12Repo;
        $this->form59Repo    = $form59Repo;

        $this->section          = 'files';
        $this->data['section']  = $this->section;

        $this->data['invoices'] = $vouchersRepo->listsDataWhere('numero','id',['tipo' => 'F']);

        $this->data['senders'] = $vouchersRepo->listsDataWhere('numero','id',['tipo' => 'R']);

        $this->data['sales'] = $salesRepo->listsData('id','id');


        $this->data['sa'] = Sales::with('Items')->with('Clients')->with('BranchesConfirm')->with('Vouchers')->with('Payments')->find(1);
    }

    public function create()
    {
        if($this->route->getParameter('salesId'))
            $this->data['sales_id'] = $this->route->getParameter('salesId');

        return parent::create(); // TODO: Change the autogenerated stub
    }



    public function form12(PDF $pdf, Sales $sales){
//        $sales = $sales->find($this->request('sales_id'));

//        $form = $this->form12Repo->create($this->request);

        $pdf->setPaper('a4', 'portland')->loadView('moto.files.formulario.form12');
//        $pdf->setPaper('a4', 'portland')->loadView('moto.files.formulario.form12',[$sales,$form]);

        return $pdf->download();

    }

    public function form59(PDF $pdf){

        $pdf->setPaper('a4', 'portland')->loadView('moto.files.formulario.form59');

        return $pdf->stream();
    }

}
